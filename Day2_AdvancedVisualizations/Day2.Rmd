
---
title: "Day 2 - Advanced and Aesthetic Visualizations"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(palmerpenguins)
library(ggplot2)
library(patchwork)
library(viridis)
library(RColorBrewer)
```

# Session 1: Faceting and Multipanel Layouts

```{r}
# Facet by species
ggplot(penguins, aes(x = flipper_length_mm, y = body_mass_g)) +
  geom_point(aes(color = island)) +
  facet_wrap(~species)

# Facet by island
ggplot(penguins, aes(x = bill_depth_mm, y = body_mass_g)) +
  geom_point() +
  facet_grid(sex ~ island)
```

# Combining plots using patchwork

```{r}
p1 <- ggplot(penguins, aes(x = species, fill = island)) +
  geom_bar(position = "dodge")

p2 <- ggplot(penguins, aes(x = bill_length_mm)) +
  geom_histogram(bins = 30, fill = "darkgreen")

p3 <- ggplot(penguins, aes(x = flipper_length_mm, y = body_mass_g)) +
  geom_point(aes(color = species))

(p1 | p2) / p3
```

# Session 2: Complex Visualizations

## PCA Biplot

```{r}
penguins_num <- penguins %>%
  select(where(is.numeric)) %>%
  drop_na()

pca <- prcomp(penguins_num, scale. = TRUE)
autoplot(pca, data = penguins, colour = "species")
```

## Heatmap

```{r}
library(reshape2)

# Create fake expression-like matrix
heatmap_data <- penguins %>%
  drop_na() %>%
  select(species, flipper_length_mm, bill_length_mm, bill_depth_mm) %>%
  group_by(species) %>%
  summarise_all(mean)

heatmap_matrix <- as.matrix(heatmap_data[, -1])
rownames(heatmap_matrix) <- heatmap_data$species

heatmap(heatmap_matrix, col = viridis(100))
```

## Violin plots

```{r}
ggplot(penguins, aes(x = species, y = body_mass_g, fill = species)) +
  geom_violin() +
  geom_jitter(width = 0.1)
```

# Session 3: Theming and Styling

```{r}
ggplot(penguins, aes(x = species, y = body_mass_g, fill = island)) +
  geom_boxplot() +
  scale_fill_brewer(palette = "Set2") +
  theme_minimal(base_size = 14) +
  theme(
    legend.position = "bottom",
    plot.title = element_text(hjust = 0.5, face = "bold")
  ) +
  labs(title = "Mass by Species and Island", y = "Mass (g)", x = "Species")
```

## Custom fonts (optional)

```{r, eval=FALSE}
# library(extrafont)
# loadfonts()
# theme(text = element_text(family = "Arial"))
```

# Session 4: Combining with cowplot

```{r}
library(cowplot)

p1 <- ggplot(penguins, aes(x = bill_length_mm)) + geom_density()
p2 <- ggplot(penguins, aes(x = flipper_length_mm)) + geom_density()

plot_grid(p1, p2, labels = c("A", "B"))
```

# Exercises

```{r}
# Create a faceted scatter plot by island and sex
ggplot(penguins, aes(x = bill_length_mm, y = bill_depth_mm, color = species)) +
  geom_point() +
  facet_grid(sex ~ island)

# Draw a heatmap of average trait values by island
avg_traits <- penguins %>%
  drop_na() %>%
  group_by(island) %>%
  summarise(across(where(is.numeric), mean))

heat_matrix <- as.matrix(avg_traits[, -1])
rownames(heat_matrix) <- avg_traits$island
heatmap(heat_matrix, col = terrain.colors(100))
```

# Annotating and Labeling

```{r}
ggplot(penguins, aes(x = bill_length_mm, y = body_mass_g)) +
  geom_point() +
  geom_text(aes(label = species), vjust = 1.5, size = 3, check_overlap = TRUE)
```

# Final Challenge

```{r}
# Create a publication-ready figure comparing mass, flipper, and bill by species and island
ggplot(penguins, aes(x = flipper_length_mm, y = body_mass_g, color = island)) +
  geom_point(alpha = 0.7, size = 3) +
  facet_wrap(~species) +
  theme_classic() +
  labs(title = "Body Mass vs Flipper Length", subtitle = "Grouped by Island and Species")
```
